<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>zange ログイン</title>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif; margin: 0; background: #f9f8f6; }
    header { padding: 16px; text-align: center; font-weight: 700; font-size: 20px; background: linear-gradient(to bottom, #E6E6FA, #fff); border-bottom: 1px solid #eee; }
    .auth-wrap { padding: 20px; max-width: 420px; margin: 0 auto; }
    .auth-card { background: #fff; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.06); padding: 24px; display: flex; flex-direction: column; gap: 14px; }
    label { font-weight: 600; font-size: 14px; }
    input { padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; width: 100%; }
    .btn { border: none; cursor: pointer; border-radius: 999px; padding: 12px; font-size: 15px; font-weight: 600; background: #cab8d9; color:#fff; box-shadow: 0 8px 20px rgba(202,184,217,.35); }
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .auth-links { text-align: left; font-size: 14px; margin-top: 6px; }
    .auth-links a { color: #2563eb; text-decoration: none; }
    .auth-links a:hover { text-decoration: underline; }
    .msg{font-size:14px;margin-top:6px}
    .msg.err{color:#b91c1c}
    .msg.ok{color:#065f46}
  </style>
</head>
<body>
  <header>
    <div style="display:flex; align-items:center; justify-content:space-between;">
      <h1 style="margin:0;">zange</h1>
    </div>
  </header>

  <main class="auth-wrap">
    <form id="loginForm" class="card auth-card" autocomplete="on">
      <label for="loginEmail">メールアドレス</label>
      <input id="loginEmail" type="email" inputmode="email" autocomplete="email" required placeholder="you@example.com" />

      <label for="loginPass">パスワード</label>
      <input id="loginPass" type="password" autocomplete="current-password" required placeholder="8文字以上が目安" />

      <button id="loginBtn" type="submit" class="btn" style="width:100%; margin-top:10px;">ログイン</button>
      <div id="loginMsg" class="msg" role="status" aria-live="polite"></div>

      <div class="auth-links">
        <a href="signup.html">新規登録はこちら</a>
      </div>
    </form>

    <div class="legal-links" style="margin-top:16px; text-align:center; font-size:13px;">
      <a href="about.html" style="margin:0 8px; text-decoration:none; color:#555;">サービス概要</a> |
      <a href="terms.html" style="margin:0 8px; text-decoration:none; color:#555;">利用規約</a> |
      <a href="privacy.html" style="margin:0 8px; text-decoration:none; color:#555;">プライバシーポリシー</a>
      <p class="copyright">© 2025 zange（テスト公開中）</p>
    </div>
  </main>

  <script>
    function setMsg(el, text, ok=false){
      el.textContent = text || '';
      el.className = 'msg ' + (ok ? 'ok' : 'err');
    }
    async function postJSON(url, data){
      const res = await fetch(url, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(data),
        credentials: 'include' // ← セッションCookie受け取り
      });
      const json = await res.json().catch(()=>({}));
      if (!res.ok || json.ok === false){
        throw new Error(json.error || ('HTTP ' + res.status));
      }
      return json;
    }

    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const pass  = document.getElementById('loginPass').value.trim();
      const btn   = document.getElementById('loginBtn');
      const msg   = document.getElementById('loginMsg');

      if (!email || !pass){
        setMsg(msg, 'メールアドレスとパスワードを入力してください');
        return;
      }
      btn.disabled = true; setMsg(msg, 'ログイン中…', true);
      try{
        await postJSON('/api/login', { email, password: pass });
        // ログイン成功→ユーザー情報を取得して保存（任意）
        const meRes = await fetch('/api/me', { credentials:'include' });
        const me = await meRes.json().catch(()=>null);
        if (me && me.ok){
          localStorage.setItem('zange_user', JSON.stringify(me.user));
        }
        location.href = 'index.html';
      }catch(err){
        setMsg(msg, err.message || 'メールアドレスまたはパスワードが違います');
      }finally{
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
